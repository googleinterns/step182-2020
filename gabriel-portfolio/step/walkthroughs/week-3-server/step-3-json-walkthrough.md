# Intro to JSON

## Getting Started

This walkthrough introduces JSON, a format that lets you send data from the
server to the client.

You can return to this walkthrough anytime by running this command:

```bash
teachme ~/step/walkthroughs/week-3-server/step-3-json-walkthrough.md
```

Click the **Start** button to begin!

## Content

So far, you've seen an example that returns a random quote from the server, and
you've modified `DataServlet` to return your name. You've seen how to return a
single string value from the server, but you'll normally want to return more
than one value in the response from a server. For example,
<walkthrough-editor-open-file
    filePath="step/portfolio/src/main/java/com/google/sps/servlets/DataServlet.java">
  DataServlet.java
</walkthrough-editor-open-file>
will eventually return a list of comments, rather than a single string.

To return multiple values, you can use any format you want: XML and key-value
pairs are popular choices.

Another common format is [JavaScript Object Notation](http://www.json.org/).
JSON is handy because JavaScript can parse JSON without requiring any external
libraries.

The next few steps walk you through some examples. You can also read more about
JSON at [W3Schools](https://www.w3schools.com/js/js_json_intro.asp) or
[MDN](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON),
or by Googling for JSON tutorials.

## JSON Syntax

The JSON format specifies a few rules:

-   Objects are enclosed in `{ }` curly brackets.
-   Objects contain `key: value` pairs. Pairs are separated by commas.
-   Field names and string values should be enclosed in `" "` double quotes.
-   Arrays are enclosed in `[ ]` square brackets.

For example, here is an object with a `name` and a `birthYear` field:

```json

{"name": "Ada", "birthYear": 1815}
```

In JavaScript, you would be able to access this object's `.name` and
`.birthYear` fields.

Here is an array that contains three objects:

```json
[
  {"name": "Ada", "birthYear": 1815},
  {"name": "Grace", "birthYear": 1906},
  {"name": "Alan", "birthYear": 1912}
]
```

In JavaScript, parsing this would give you an array, which you could access by
index. Each element in the array would contain `.name` and `.birthYear` fields.

Note that JSON can contain newlines and indentation to make it more
human-readable, but the parser ignores whitespace.

JSON objects can also be nested, with objects containing other objects, or
arrays, or arrays of objects. Here's an object that contains an array of other
objects:

```json
{
  "people": [
    {"name": "Ada", "birthYear": 1815},
    {"name": "Grace", "birthYear": 1906},
    {"name": "Alan", "birthYear": 1912}
  ]
}
```

In JavaScript, parsing this would give you an object with a `.people` field that
referenced an array of objects. Each object has a `.name` and a `.birthYear` field.

[MDN](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON) has more JSON examples.

## Creating JSON

Generally, you'll create a JSON string on the server, in Java. One way to do
that is by manually building the string yourself.

The `server-stats` directory contains an example that uses JSON. Open the
<walkthrough-editor-open-file
    filePath="step/walkthroughs/week-3-server/examples/server-stats/src/main/java/com/google/sps/servlets/ServerStatsServlet.java">
  ServerStatsServlet.java
</walkthrough-editor-open-file>
file. This class creates an instance of a `ServerStats` class, and its
`convertToJson()` function converts that instance to a JSON-formatted string
by manually building a string. The servlet then sends this JSON string to the
client as the response.

Run a development server from the `server-stats` directory, and then navigate to
`/server-stats` to see the JSON content generated by the server.

## Gson

Formatting data as JSON can be tedious and error-prone. Instead of doing it
yourself, you can use a library that does it for you!

[Gson](https://github.com/google/gson) is an open-source Java library that
formats Java objects as JSON strings. The
<walkthrough-editor-open-file
    filePath="step/walkthroughs/week-3-server/examples/server-stats/src/main/java/com/google/sps/servlets/ServerStatsServlet.java">
  ServerStatsServlet.java
</walkthrough-editor-open-file>
file contains an example `convertToJsonUsingGson()` function that converts a
`ServerStats` instance to JSON using the Gson library.

The output of the `convertToJson()` function and the `convertToJsonUsingGson()`
function is the same JSON string. You can use whichever approach you prefer.

**Note:** To use Gson, first add this dependency to your
<walkthrough-editor-open-file
    filePath="step/portfolio/pom.xml">
  pom.xml
</walkthrough-editor-open-file>
file:

```xml
<dependency>
  <groupId>com.google.code.gson</groupId>
  <artifactId>gson</artifactId>
  <version>2.8.6</version>
</dependency>
```

This tells Maven to add the Gson library to your project. Now you can use it in
your Java code.

## Parsing JSON

Now you know how to create JSON on the server. Next, you need to parse the JSON
in JavaScript to convert it into an object.

Since you're using the `fetch()` function to retrieve JSON from the server,
you can use the built-in `json()` function to parse the response into objects
you can use in JavaScript.

Here's an example:

```javascript
fetch('/my-data-url')  // sends a request to /my-data-url
.then(response => response.json()) // parses the response as JSON
.then((myObject) => { // now we can reference the fields in myObject!
  console.log(myObject.x);
  console.log(myObject.y);
  console.log(myObject.z);
});
```

To see a more complete example, look at the example
<walkthrough-editor-open-file
    filePath="step/walkthroughs/week-3-server/examples/server-stats/src/main/webapp/script.js">
  script.js
</walkthrough-editor-open-file>
file in the `server-stats` directory. The `getServerStats()` function calls
`fetch()`, parses the response as JSON, and then uses the object to build HTML
content.

Run a development server from the `server-stats` directory, and then navigate to
`/index.html` to see this in action.

## Your Turn

Remember that your goal this week is to create a servlet that stores comments,
and to write JavaScript that builds a UI from that data.

To get closer to this goal, modify
<walkthrough-editor-open-file
    filePath="step/portfolio/src/main/java/com/google/sps/servlets/DataServlet.java">
  DataServlet.java
</walkthrough-editor-open-file>
to return some hard-coded JSON data, and then modify
<walkthrough-editor-open-file
    filePath="step/portfolio/src/main/webapp/script.js">
  script.js
</walkthrough-editor-open-file>
to fetch that JSON and build a UI from it. To break it down into smaller steps:

1.  Modify `DataServlet` to contain an `ArrayList<String>` variable containing a
    few hard-coded messages. Keep it simple! An `ArrayList` containing three
    hard-coded values is good enough.
2.  Modify `DataServlet` so its `doGet()` function returns the `ArrayList` as a
    JSON string. Confirm this works by running a dev server and navigating to the
    `/data` URL in your browser.
3.  Modify `script.js` to fetch the JSON string from the server. Confirm this
    works by printing it to the JavaScript console.
4.  Modify `script.js` to add the hard-coded comments to the page.

Don't spend too much time making the page look pretty. You can always come back
after you have everything working.

For now, all you need is hard-coded data. The goal of this step was to get JSON
formatting and parsing working. You'll learn how to get user input in the next
step. For now, make sure the JSON formatting and parsing is working before
moving on!

## Pull Request

<walkthrough-conclusion-trophy></walkthrough-conclusion-trophy>

Congratulations!

At this point, your server should be returning hard-coded comments data, and
your JavaScript should be fetching this data and using it to add HTML elements
to the page.

Create a pull request from what you have so far, and send it to your host for
review.

Then go back to the comments walkthrough to continue:

```bash
teachme ~/step/walkthroughs/week-3-server/comments-walkthrough.md
```